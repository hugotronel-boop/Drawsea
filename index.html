<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compteur de Pas & Tracé</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .counter {
      text-align: center;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      width: 90%;
      max-width: 400px;
    }
    h1 { margin: 0; font-size: 2.5rem; color: #333; }
    p { margin: 10px 0 0; font-size: 1.2rem; color: #666; }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
    canvas {
      border: 2px solid #ccc;
      border-radius: 10px;
      background: white;
      width: 90%;
      max-width: 400px;
      height: 400px;
    }
  </style>
</head>
<body>

<div class="counter">
  <h1 id="stepCount">0</h1>
  <p>Pas détectés</p>
  <button id="startBtn">Activer l'accéléromètre</button>
  <button id="resetBtn" style="display:none;">Réinitialiser</button>
</div>

<canvas id="mapCanvas"></canvas>

<script>
  let steps = 0;
  let lastAcc = { x: null, y: null, z: null };
  const threshold = 12; // sensibilité
  const stepDisplay = document.getElementById('stepCount');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');

  // --- Canvas pour tracer ---
  const canvas = document.getElementById('mapCanvas');
  const ctx = canvas.getContext('2d');
  let width = canvas.width = canvas.offsetWidth;
  let height = canvas.height = canvas.offsetHeight;
  let pos = { x: width/2, y: height/2 }; // départ au centre
  let path = [{...pos}]; // tableau pour tracer les points

  function drawPath() {
    ctx.clearRect(0, 0, width, height);
    ctx.beginPath();
    ctx.moveTo(path[0].x, path[0].y);
    for(let i = 1; i < path.length; i++){
      ctx.lineTo(path[i].x, path[i].y);
    }
    ctx.strokeStyle = "#4CAF50";
    ctx.lineWidth = 3;
    ctx.stroke();
    // Point actuel
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, 6, 0, Math.PI*2);
    ctx.fillStyle = "#FF5722";
    ctx.fill();
  }

  function handleMotion(event) {
    const acc = event.accelerationIncludingGravity;
    if (lastAcc.x !== null) {
      const deltaX = Math.abs(acc.x - lastAcc.x);
      const deltaY = Math.abs(acc.y - lastAcc.y);
      const deltaZ = Math.abs(acc.z - lastAcc.z);
      const totalMovement = deltaX + deltaY + deltaZ;
      if (totalMovement > threshold) {
        steps++;
        stepDisplay.textContent = steps;

        // --- Déplacer sur la carte (simulation aléatoire simple) ---
        const angle = Math.random() * 2 * Math.PI; // mouvement aléatoire
        const distance = 10; // pixels par pas
        pos.x += Math.cos(angle) * distance;
        pos.y += Math.sin(angle) * distance;
        // Limite aux bords
        pos.x = Math.max(0, Math.min(width, pos.x));
        pos.y = Math.max(0, Math.min(height, pos.y));
        path.push({...pos});
        drawPath();
      }
    }
    lastAcc = { x: acc.x, y: acc.y, z: acc.z };
  }

  function initMotion() {
    if (typeof DeviceMotionEvent.requestPermission === 'function') {
      DeviceMotionEvent.requestPermission()
        .then(response => {
          if(response === 'granted'){
            window.addEventListener('devicemotion', handleMotion);
            startBtn.style.display = 'none';
            resetBtn.style.display = 'inline-block';
          } else {
            alert("Permission refusée");
          }
        })
        .catch(console.error);
    } else {
      window.addEventListener('devicemotion', handleMotion);
      startBtn.style.display = 'none';
      resetBtn.style.display = 'inline-block';
    }
  }

  startBtn.addEventListener('click', initMotion);

  resetBtn.addEventListener('click', () => {
    steps = 0;
    stepDisplay.textContent = steps;
    pos = { x: width/2, y: height/2 };
    path = [{...pos}];
    drawPath();
  });

  window.addEventListener('resize', () => {
    width = canvas.width = canvas.offsetWidth;
    height = canvas.height = canvas.offsetHeight;
    drawPath();
  });

  drawPath();
</script>

</body>
</html>
